# 實作計劃

- [x] 1. 建立專案結構和核心配置
  - 使用 Spring Initializr 建立 Spring Boot 3.x 專案，包含 Web、Security、JPA、Redis 依賴
  - 配置 Gradle 建置檔案，包含所需的依賴項目
  - 建立標準的 Maven/Gradle 目錄結構和套件組織
  - 配置 application.yml 檔案，包含資料庫、Redis、JWT 設定
  - _需求: 5.1, 5.4, 6.1, 7.3_

- [ ] 2. 實作資料模型和實體類別
  - [x] 2.1 建立 User 實體類別和 JPA 映射
    - 實作 User 實體類別，包含所有必要欄位和 JPA 註解
    - 建立 User Repository 介面，繼承 JpaRepository
    - 撰寫 User 實體的單元測試
    - _需求: 1.2, 7.1_

  - [x] 2.2 建立 Message 實體類別和關聯關係
    - 實作 Message 實體類別，包含與 User 的關聯關係
    - 實作自我參照的父子留言關係
    - 建立 Message Repository 介面，包含自訂查詢方法
    - 撰寫 Message 實體和關聯關係的單元測試
    - _需求: 2.2, 2.3, 4.2, 7.2_

  - [x] 2.3 建立 TokenBlacklist 實體和資料庫初始化
    - 實作 TokenBlacklist 實體類別用於 JWT token 管理
    - 建立資料庫初始化腳本和 Flyway 遷移檔案
    - 配置 JPA 資料庫連線和交易管理
    - 撰寫資料庫連線和初始化的整合測試
    - _需求: 1.3, 7.4_

- [ ] 3. 實作 JWT 認證和安全配置
  - [x] 3.1 建立 JWT 工具類別和 Token 管理
    - 實作 JwtUtil 類別，包含 token 生成、驗證、解析功能
    - 實作 TokenBlacklistService 管理 token 黑名單
    - 建立 JWT 相關的配置類別和常數定義
    - 撰寫 JWT 工具類別的單元測試
    - _需求: 1.3, 1.4_

  - [x] 3.2 實作 Spring Security 配置和過濾器
    - 建立 SecurityConfig 配置類別，設定 JWT 認證流程
    - 實作 JwtAuthenticationFilter 攔截和驗證 JWT token
    - 配置 CORS 和 API 端點的安全規則
    - 撰寫安全配置和過濾器的整合測試
    - _需求: 1.1, 5.3_

- [x] 4. 實作 SSO 整合和使用者服務
  - [x] 4.1 建立 SSO 整合服務
    - 實作 SSOService 處理外部 SSO 提供者的整合
    - 建立 OAuth2 或 SAML 設定檔案和回調處理
    - 實作使用者資料同步邏輯，從 SSO 建立或更新本地使用者
    - 撰寫 SSO 整合流程的單元測試
    - _需求: 1.1, 1.2_

  - [x] 4.2 實作使用者服務層
    - 建立 UserService 類別，包含使用者 CRUD 操作
    - 實作使用者搜尋功能，支援用戶名和顯示名稱搜尋
    - 實作使用者資料驗證和業務邏輯
    - 撰寫 UserService 的單元測試，包含各種邊界情況
    - _需求: 3.1, 3.2_

- [x] 5. 實作 Redis 快取服務
  - [x] 5.1 建立 Redis 配置和連線管理
    - 配置 RedisTemplate 和 StringRedisTemplate Bean
    - 建立 Redis 連線池設定和錯誤處理
    - 實作 Redis 健康檢查和監控
    - 撰寫 Redis 連線和基本操作的整合測試
    - _需求: 6.1, 6.4_

  - [x] 5.2 實作快取服務層
    - 建立 CacheService 介面和實作類別
    - 實作使用者資料、留言資料的快取邏輯
    - 實作快取更新和失效策略
    - 撰寫快取服務的單元測試和整合測試
    - _需求: 6.1, 6.2, 6.3_

- [ ] 6. 實作留言和留言板服務
  - [x] 6.1 建立留言服務層
    - 實作 MessageService 類別，包含留言 CRUD 操作
    - 實作留言內容驗證和字數限制檢查
    - 實作留言權限控制，確保只有作者能編輯刪除
    - 撰寫 MessageService 的單元測試，涵蓋所有業務邏輯
    - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

  - [x] 6.2 實作留言回覆功能
    - 擴展 MessageService 支援回覆留言功能
    - 實作回覆的層級結構和關聯關係處理
    - 實作回覆權限控制和驗證邏輯
    - 撰寫回覆功能的單元測試和整合測試

    - _需求: 4.1, 4.2, 4.3, 4.4_

  - [ ] 6.3 實作留言板服務
    - 建立 BoardService 類別，管理使用者留言板
    - 實作留言板檢視權限控制
    - 實作留言分頁查詢和排序功能
    - 撰寫留言板服務的單元測試
    - _需求: 3.1, 3.2, 3.3, 3.4_

- [ ] 7. 實作 RESTful API 控制器
  - [ ] 7.1 建立認證相關 API
    - 實作 AuthController，包含登入、登出、token 刷新端點
    - 實作 API 請求和回應的 DTO 類別
    - 加入 API 驗證和錯誤處理
    - 撰寫認證 API 的整合測試
    - _需求: 1.1, 1.3, 1.4, 5.1, 5.2_

  - [ ] 7.2 建立使用者管理 API
    - 實作 UserController，包含使用者查詢和更新端點
    - 實作使用者搜尋 API 和分頁功能
    - 加入 API 參數驗證和權限檢查
    - 撰寫使用者 API 的整合測試
    - _需求: 3.1, 3.2, 5.1, 5.2, 5.4_

  - [ ] 7.3 建立留言管理 API
    - 實作 MessageController，包含留言 CRUD 和回覆端點
    - 實作留言分頁查詢和篩選功能
    - 加入留言內容驗證和權限控制
    - 撰寫留言 API 的整合測試
    - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.4_

  - [ ] 7.4 建立留言板 API
    - 實作 BoardController，包含留言板檢視和統計端點
    - 實作留言板權限控制和存取限制
    - 加入留言板資料的快取整合
    - 撰寫留言板 API 的整合測試
    - _需求: 3.1, 3.2, 3.3, 3.4, 5.1, 5.2, 5.4_

- [ ] 8. 實作全域異常處理和 API 文件
  - [ ] 8.1 建立全域異常處理器
    - 實作 GlobalExceptionHandler 使用 @ControllerAdvice
    - 定義標準化的錯誤回應格式和狀態碼
    - 實作不同類型異常的處理邏輯
    - 撰寫異常處理器的單元測試
    - _需求: 5.1, 5.2_

  - [ ] 8.2 整合 API 文件生成
    - 配置 SpringDoc OpenAPI 3 依賴和設定
    - 為所有 Controller 加入 API 文件註解
    - 配置 Swagger UI 和 API 文件存取端點
    - 驗證 API 文件的完整性和正確性
    - _需求: 5.1, 5.4_

- [ ] 9. 實作應用程式配置和部署準備
  - [ ] 9.1 建立環境配置和 Profile 管理
    - 建立 dev、test、prod 環境的配置檔案
    - 配置資料庫連線池和 Redis 連線設定
    - 實作應用程式健康檢查端點
    - 建立 Docker 容器化配置檔案
    - _需求: 6.3, 7.3, 7.4_

  - [ ] 9.2 實作日誌和監控配置
    - 配置 Logback 日誌框架和日誌格式
    - 實作關鍵業務操作的日誌記錄
    - 配置 Actuator 監控端點
    - 建立應用程式啟動和關閉的腳本
    - _需求: 6.3_

- [ ] 10. 撰寫端對端測試和整合驗證
  - 建立完整的使用者流程端對端測試
  - 實作 API 契約測試，驗證所有端點的正確性
  - 執行效能測試，確保系統在負載下的穩定性
  - 驗證快取機制和資料一致性
  - 執行安全性測試，驗證認證和授權機制
  - _需求: 1.1, 1.2, 1.3, 1.4, 2.1-2.5, 3.1-3.4, 4.1-4.4, 5.1-5.4, 6.1-6.4, 7.1-7.4_