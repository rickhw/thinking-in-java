<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Title Test - Message Board</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-title {
            color: #333;
            margin-bottom: 10px;
        }
        .test-result {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Page Title and SEO Meta Tags Test</h1>
    
    <div class="test-section">
        <h2 class="test-title">Current Page Information</h2>
        <div class="test-result">
            <div><strong>Title:</strong> <span id="current-title"></span></div>
            <div><strong>Description:</strong> <span id="current-description"></span></div>
            <div><strong>OG Title:</strong> <span id="current-og-title"></span></div>
            <div><strong>OG Description:</strong> <span id="current-og-description"></span></div>
            <div><strong>OG Type:</strong> <span id="current-og-type"></span></div>
            <div><strong>OG URL:</strong> <span id="current-og-url"></span></div>
            <div><strong>Structured Data:</strong> <span id="current-structured-data"></span></div>
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-title">Test Page Title Updates</h2>
        <button onclick="testMessageTitle()">Test Message Title</button>
        <button onclick="testLongMessageTitle()">Test Long Message</button>
        <button onclick="testLoadingTitle()">Test Loading Title</button>
        <button onclick="testErrorTitle()">Test Error Title</button>
        <button onclick="testNotFoundTitle()">Test Not Found Title</button>
        <button onclick="resetTitle()">Reset Title</button>
    </div>

    <div class="test-section">
        <h2 class="test-title">Test Results</h2>
        <div id="test-results" class="test-result">
            Click the buttons above to test different page title scenarios.
        </div>
    </div>

    <script>
        // Mock PageContext functionality for testing
        function updatePageMeta({ title, description, author, publishedTime }) {
            // Update document title
            if (title) {
                document.title = title;
            }

            // Update meta description
            if (description) {
                let metaDescription = document.querySelector('meta[name="description"]');
                if (!metaDescription) {
                    metaDescription = document.createElement('meta');
                    metaDescription.name = 'description';
                    document.head.appendChild(metaDescription);
                }
                metaDescription.content = description;
            }

            // Update Open Graph meta tags
            if (title || description) {
                // Update or create og:title
                let ogTitle = document.querySelector('meta[property="og:title"]');
                if (!ogTitle) {
                    ogTitle = document.createElement('meta');
                    ogTitle.setAttribute('property', 'og:title');
                    document.head.appendChild(ogTitle);
                }
                ogTitle.content = title;

                // Update or create og:description
                if (description) {
                    let ogDescription = document.querySelector('meta[property="og:description"]');
                    if (!ogDescription) {
                        ogDescription = document.createElement('meta');
                        ogDescription.setAttribute('property', 'og:description');
                        document.head.appendChild(ogDescription);
                    }
                    ogDescription.content = description;
                }

                // Update or create og:type
                let ogType = document.querySelector('meta[property="og:type"]');
                if (!ogType) {
                    ogType = document.createElement('meta');
                    ogType.setAttribute('property', 'og:type');
                    document.head.appendChild(ogType);
                }
                ogType.content = description ? 'article' : 'website';

                // Update or create og:url
                let ogUrl = document.querySelector('meta[property="og:url"]');
                if (!ogUrl) {
                    ogUrl = document.createElement('meta');
                    ogUrl.setAttribute('property', 'og:url');
                    document.head.appendChild(ogUrl);
                }
                ogUrl.content = window.location.href;
            }

            // Update structured data (JSON-LD)
            if (description && author && publishedTime) {
                // Remove existing structured data
                const existingScript = document.querySelector('script[type="application/ld+json"]');
                if (existingScript) {
                    existingScript.remove();
                }

                // Create new structured data
                const structuredData = {
                    "@context": "https://schema.org",
                    "@type": "SocialMediaPosting",
                    "headline": title,
                    "author": {
                        "@type": "Person",
                        "name": author
                    },
                    "datePublished": publishedTime,
                    "text": description
                };

                const script = document.createElement('script');
                script.type = 'application/ld+json';
                script.textContent = JSON.stringify(structuredData);
                document.head.appendChild(script);
            }

            // Update display
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('current-title').textContent = document.title;
            
            const description = document.querySelector('meta[name="description"]');
            document.getElementById('current-description').textContent = description ? description.content : 'None';
            
            const ogTitle = document.querySelector('meta[property="og:title"]');
            document.getElementById('current-og-title').textContent = ogTitle ? ogTitle.content : 'None';
            
            const ogDescription = document.querySelector('meta[property="og:description"]');
            document.getElementById('current-og-description').textContent = ogDescription ? ogDescription.content : 'None';
            
            const ogType = document.querySelector('meta[property="og:type"]');
            document.getElementById('current-og-type').textContent = ogType ? ogType.content : 'None';
            
            const ogUrl = document.querySelector('meta[property="og:url"]');
            document.getElementById('current-og-url').textContent = ogUrl ? ogUrl.content : 'None';
            
            const structuredData = document.querySelector('script[type="application/ld+json"]');
            document.getElementById('current-structured-data').textContent = structuredData ? 'Present' : 'None';
        }

        function testMessageTitle() {
            const mockMessage = {
                content: "é€™æ˜¯ä¸€å€‹æ¸¬è©¦è¨Šæ¯ï¼Œç”¨ä¾†é©—è­‰é é¢æ¨™é¡ŒåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚é€™å€‹è¨Šæ¯åŒ…å«äº†è¶³å¤ çš„å…§å®¹ä¾†æ¸¬è©¦æ¨™é¡Œæˆªæ–·åŠŸèƒ½ï¼Œä»¥åŠç¢ºä¿SEOå„ªåŒ–çš„metaæ¨™ç±¤éƒ½èƒ½æ­£ç¢ºè¨­ç½®ã€‚",
                userId: "testuser",
                createdAt: "2025-01-08T10:00:00Z",
                updatedAt: "2025-01-08T10:30:00Z"
            };

            // Clean text for SEO (remove extra whitespace and line breaks)
            const cleanContent = mockMessage.content.replace(/\s+/g, ' ').replace(/\n/g, ' ').trim();
            
            const messagePreview = cleanContent.length > 50 
                ? cleanContent.substring(0, 50).trim() + '...' 
                : cleanContent;
            
            const messageDescription = cleanContent.length > 150 
                ? cleanContent.substring(0, 150).trim() + '...' 
                : cleanContent;

            updatePageMeta({
                title: `${messagePreview} - Message Board`,
                description: messageDescription,
                author: mockMessage.userId,
                publishedTime: mockMessage.createdAt
            });

            document.getElementById('test-results').innerHTML = 
                '<strong>âœ… Message Title Test:</strong> Updated page title with message content preview (50 chars), description (150 chars), and full SEO meta tags including structured data.';
        }

        function testLoadingTitle() {
            updatePageMeta({
                title: 'è¼‰å…¥ä¸­... - Message Board',
                description: 'æ­£åœ¨è¼‰å…¥è¨Šæ¯å…§å®¹...',
                author: '',
                publishedTime: ''
            });

            document.getElementById('test-results').innerHTML = 
                '<strong>â³ Loading Title Test:</strong> Updated page title to show loading state.';
        }

        function testErrorTitle() {
            updatePageMeta({
                title: 'è¼‰å…¥éŒ¯èª¤ - Message Board',
                description: 'è¼‰å…¥è¨Šæ¯æ™‚ç™¼ç”ŸéŒ¯èª¤',
                author: '',
                publishedTime: ''
            });

            document.getElementById('test-results').innerHTML = 
                '<strong>âŒ Error Title Test:</strong> Updated page title to show error state.';
        }

        function testLongMessageTitle() {
            const mockMessage = {
                content: "é€™æ˜¯ä¸€å€‹éå¸¸é•·çš„æ¸¬è©¦è¨Šæ¯ï¼Œç”¨ä¾†é©—è­‰ç•¶è¨Šæ¯å…§å®¹è¶…éé è¨­çš„å­—ç¬¦é™åˆ¶æ™‚ï¼Œé é¢æ¨™é¡Œå’Œæè¿°çš„æˆªæ–·åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚é€™å€‹è¨Šæ¯æ•…æ„å¯«å¾—å¾ˆé•·ï¼ŒåŒ…å«äº†å¤§é‡çš„æ–‡å­—å…§å®¹ï¼Œä»¥ç¢ºä¿æˆ‘å€‘çš„SEOå„ªåŒ–åŠŸèƒ½èƒ½å¤ æ­£ç¢ºè™•ç†é•·æ–‡æœ¬çš„æƒ…æ³ã€‚åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œç”¨æˆ¶å¯èƒ½æœƒç™¼å¸ƒå¾ˆé•·çš„è¨Šæ¯ï¼Œæˆ‘å€‘éœ€è¦ç¢ºä¿é€™äº›é•·è¨Šæ¯ä¸æœƒç ´å£é é¢çš„SEOè¡¨ç¾ï¼ŒåŒæ™‚ä¹Ÿè¦ä¿æŒæ¨™é¡Œå’Œæè¿°çš„å¯è®€æ€§ã€‚é€™å€‹æ¸¬è©¦å°‡é©—è­‰æ–‡æœ¬æˆªæ–·ã€æ¸…ç†å’Œæ ¼å¼åŒ–åŠŸèƒ½æ˜¯å¦éƒ½èƒ½æ­£å¸¸é‹ä½œã€‚",
                userId: "longtextuser",
                createdAt: "2025-01-08T11:00:00Z"
            };

            const cleanContent = mockMessage.content.replace(/\s+/g, ' ').replace(/\n/g, ' ').trim();
            
            const messagePreview = cleanContent.length > 50 
                ? cleanContent.substring(0, 50).trim() + '...' 
                : cleanContent;
            
            const messageDescription = cleanContent.length > 150 
                ? cleanContent.substring(0, 150).trim() + '...' 
                : cleanContent;

            updatePageMeta({
                title: `${messagePreview} - Message Board`,
                description: messageDescription,
                author: mockMessage.userId,
                publishedTime: mockMessage.createdAt
            });

            document.getElementById('test-results').innerHTML = 
                '<strong>ğŸ“ Long Message Test:</strong> Tested with very long content. Title truncated to 50 chars, description to 150 chars.';
        }

        function testNotFoundTitle() {
            updatePageMeta({
                title: 'è¨Šæ¯ä¸å­˜åœ¨ - Message Board',
                description: 'æ‚¨è¦æŸ¥çœ‹çš„è¨Šæ¯å¯èƒ½å·²è¢«åˆªé™¤æˆ–ä¸å­˜åœ¨',
                author: '',
                publishedTime: ''
            });

            document.getElementById('test-results').innerHTML = 
                '<strong>ğŸ” Not Found Title Test:</strong> Updated page title to show not found state.';
        }

        function resetTitle() {
            document.title = 'Page Title Test - Message Board';
            
            // Remove meta tags
            const metaDescription = document.querySelector('meta[name="description"]');
            if (metaDescription) metaDescription.remove();
            
            const ogTitle = document.querySelector('meta[property="og:title"]');
            if (ogTitle) ogTitle.remove();
            
            const ogDescription = document.querySelector('meta[property="og:description"]');
            if (ogDescription) ogDescription.remove();
            
            const ogType = document.querySelector('meta[property="og:type"]');
            if (ogType) ogType.remove();
            
            const ogUrl = document.querySelector('meta[property="og:url"]');
            if (ogUrl) ogUrl.remove();
            
            const structuredData = document.querySelector('script[type="application/ld+json"]');
            if (structuredData) structuredData.remove();

            updateDisplay();
            
            document.getElementById('test-results').innerHTML = 
                '<strong>ğŸ”„ Reset Test:</strong> Reset page title and removed all meta tags.';
        }

        // Initialize display on page load
        document.addEventListener('DOMContentLoaded', updateDisplay);
    </script>
</body>
</html>